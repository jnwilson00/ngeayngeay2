
var vcht_selectionMode=false;var vcht_documentBody;var vcht_avatarSel=false;var nua=navigator.userAgent;var vcht_elementShow="";var vcht_chatID=0;var vcht_userID=0;var vcht_isLogged=false;var vcht_currentOperator=false;var vcht_currentUser=false;var vcht_currentFiles=new Array();var vcht_uploadFilesDropzone;var vcht_checkMsgTimer=false;var vcht_shownElement="";var vcht_uploadFilesDropzone;var vcht_geoDone=false;var vcht_timerBounce=false;jQuery(window).on("load",function(){vcht_documentBody=jQuery("html,body");jQuery.each(vcht_data.texts,function(a){var b=this;b=b.replace(/\n/g,"<br/>");b=b.replace(/\\n/g,"<br/>");b=b.replace(/<br \/>/g,"<br/>");b=b.replace(/<br\/><br\/>/g,"<br/>");vcht_data.texts[a]=b});if(!vcht_isIframe()){if(vcht_elementShow!=""&&vcht_elementShow.length>0){vcht_showElement(vcht_elementShow)}}jQuery("*").click(function(a){if(vcht_selectionMode){if(jQuery(this).children().length==0||jQuery(this).is("a")||jQuery(this).is("button")||jQuery(this).is("img")||jQuery(this).is("select")){a.preventDefault();jQuery(".vcht_selectedDom").removeClass("vcht_selectedDom");jQuery(this).addClass("vcht_selectedDom");window.parent.vcht_selectDomElement(this);vcht_selectionMode=false}}});if(!vcht_isIframe()){if(vcht_data.enableChat==1){vcht_initChatPanel();vcht_initBounce();if(sessionStorage.getItem("vcht_geoSend")===null||sessionStorage.vcht_geoSend!=="true"){vcht_geoSend()}if(sessionStorage.getItem("vcht_isChatting")!==null&&sessionStorage.vcht_isChatting==="true"){vcht_checkIfChatActive()}else{}if(sessionStorage.getItem("vcht_shownElement")!==null&&sessionStorage.getItem("vcht_shownElement")!=""){vcht_showElement(sessionStorage.getItem("vcht_shownElement"),false);sessionStorage.vcht_shownElement="";vcht_minify()}if(vcht_data.vtrk==1){vcht_vtrkTimer()}vcht_checkMsgTimer=setInterval(vcht_checkNewMessages,vcht_data.ajaxCheckDelay*1000)}jQuery(window).resize(vcht_onResize);vcht_onResize()}});function vcht_geoSend(){if(vcht_data.enableGeolocalization==1){jQuery.ajax({type:"post",url:vcht_data.ajaxurl,data:{action:"client_geolocalize"},success:function(a){a=a.trim();if(a=="1"){sessionStorage.vcht_geoSend=true}}})}}function vcht_checkIfChatActive(){jQuery.ajax({type:"post",url:vcht_data.ajaxurl,data:{action:"client_checkChatActive"},success:function(a){if(a==1){vcht_expand()}else{sessionStorage.vcht_isChatting=false}}})}function vcht_vtrkTimer(){if(!jQuery("#vcht_chatPanel").is(".vcht_hiddenPanel")&&(sessionStorage.getItem("vcht_isChatting")===null||sessionStorage.vcht_isChatting=="false")){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_updateClient",url:document.location.href},success:function(a){if(sessionStorage.getItem("vcht_geoSend")===null||sessionStorage.vcht_geoSend!=="true"){vcht_geoSend()}setTimeout(vcht_vtrkTimer,vcht_data.trkDelay*1000);if(a=="chat"){if(!jQuery("#vcht_chatPanel").is(".vcht_hiddenPanel")){sessionStorage.vcht_isChatting=true;vcht_startChat(null,true);vcht_expand();if(jQuery("#vcht_audioMsg").data("enable")!="false"){jQuery("#vcht_audioMsg").get(0).play();if(jQuery("#vcht_chatPanel").is(".vcht_minify")){vcht_minify()}}}}}})}else{setTimeout(vcht_vtrkTimer,vcht_data.trkDelay*1000)}}function vcht_onResize(){jQuery("#vcht_chatPanel > div:not(#vcht_chatHeader)").css({height:jQuery("#vcht_chatPanel").height()-jQuery("#vcht_chatHeader").height()});jQuery("#vcht_writeBtnsCt").css({marginRight:0-jQuery("#vcht_writeBtnsCt").width()});jQuery("#vcht_writeMsgContainer").css({marginRight:jQuery("#vcht_writeBtnsCt").width()});jQuery("#vcht_history").css({height:jQuery("#vcht_chatCommPanel").innerHeight()-(jQuery("#vcht_writeMsgContainer").outerHeight()+18)});jQuery("#vcht_uploadFilesField").css({height:jQuery("#vcht_uploadFilesPanel").height()-(parseInt(jQuery("#vcht_uploadFilesPanel").css("padding-top"))+jQuery("#vcht_uploadFilesBtnCt").height())})}function vcht_isIframe(){try{return window.self!==window.top}catch(a){return true}}function vcht_startSelection(){vcht_selectionMode=true}function vcht_showElement(b,a){jQuery(".vcht_selectedDom").removeClass("vcht_selectedDom");if(jQuery(b).length>0){if(jQuery(window).width()<=480){vcht_minify()}if(jQuery(".vcht_avatarSel").length>0){vcht_avatarSel=jQuery(".vcht_avatarSel")}else{if(a){vcht_avatarSel=jQuery('<div class="vcht_avatarSel" style="background-image: none;"><div class="vcht_avatarArrow"></div><img src="'+a+'" alt=""/></div>')}else{vcht_avatarSel=jQuery('<div class="vcht_avatarSel"><div class="vcht_avatarArrow"></div></div>')}}jQuery("body").append(vcht_avatarSel);jQuery(b).addClass("vcht_selectedDom");if(vcht_isAnyParentFixed(jQuery(b))){if(jQuery(b).position().top-140<0){vcht_avatarSel.addClass("bottom");vcht_avatarSel.css({top:jQuery(b).position().top+jQuery(b).outerHeight()+70,left:jQuery(b).position().left+jQuery(b).outerWidth()/2})}else{vcht_avatarSel.removeClass("bottom");vcht_avatarSel.css({top:jQuery(b).position().top-70,left:jQuery(b).position().left+jQuery(b).outerWidth()/2})}jQuery(vcht_documentBody).animate({scrollTop:jQuery(b).position().top-200},500)}else{if(jQuery(b).offset().top-140<0){vcht_avatarSel.addClass("bottom");vcht_avatarSel.css({top:jQuery(b).offset().top+jQuery(b).outerHeight()+70,left:jQuery(b).offset().left+jQuery(b).outerWidth()/2})}else{vcht_avatarSel.removeClass("bottom");vcht_avatarSel.css({top:jQuery(b).offset().top-70,left:jQuery(b).offset().left+jQuery(b).outerWidth()/2})}jQuery(vcht_documentBody).animate({scrollTop:jQuery(b).offset().top-200},500)}vcht_avatarSel.fadeIn();if(jQuery("#vcht_chatPanel").is(".vcht_fullscreen")){vcht_fullscreen()}}}function vcht_stopShowElement(){jQuery(".vcht_selectedDom").removeClass("vcht_selectedDom");jQuery(".vcht_avatarSel").fadeOut()}function vcht_isAnyParentFixed(a,b){if(!b){var b=false}try{if(a.parent().length>0&&a.parent().css("position")=="fixed"){b=true}}catch(c){}if(!b&&a.parent().length>0){b=vcht_isAnyParentFixed(a.parent(),b)}return b}function vcht_initChatPanel(){var a="false";if(vcht_data.playSoundCustomer=="1"){a="true"}jQuery("body").append('<audio id="vcht_audioMsg" controls data-enable="'+a+'"><source src="'+vcht_data.assetsUrl+'/sound/message.ogg" type="audio/ogg"><source src="'+vcht_data.assetsUrl+'/sound/message.mp3" type="audio/mpeg"></audio>');var c=jQuery('<div id="vcht_chatPanel" class="vcht_bootstrap vcht_minify"></div>');jQuery("body").append(c);c.append('<div id="vcht_chatHeader"></div>');c.find("#vcht_chatHeader").append('<span class="vcht_title">'+vcht_data.texts["Need Help ?"]+"</span>");if(vcht_data.showCloseBtn==1){c.find("#vcht_chatHeader").append('<a href="javascript:" id="vcht_btnClose"  class="vcht_btn" onclick="vcht_closeChat();"><span class="fa fa-times"></span></a>')}if(vcht_data.showFullscreenBtn==1){c.find("#vcht_chatHeader").append('<a href="javascript:" id="vcht_btnFullScreen" class="vcht_btn" onclick="vcht_fullscreen();"><span class="fa fa-window-maximize"></span></a>')}if(vcht_data.showMinifyBtn==1){c.find("#vcht_chatHeader").append('<a href="javascript:" id="vcht_btnMinify" class="vcht_btn" onclick="vcht_minify();"><span class="fa fa-window-minimize"></span></a>')}jQuery("#vcht_chatHeader").click(function(){if(jQuery(this).find("a.vcht_btn:hover").length==0){vcht_minify()}});c.append('<div id="vcht_chatContactForm" class="vcht_scrollbar"></div>');if(vcht_data.contactFormIcon!=""){jQuery("#vcht_chatContactForm").append('<div class="vcht_mainIcon"><span class="fa '+vcht_data.contactFormIcon+'"></span></div>')}jQuery("#vcht_chatContactForm").append("<p>"+vcht_data.texts["Sorry, there is currently no operator online. Feel free to contact us by using the form below."]+"</p>");if(vcht_data.enableContactForm=="1"){jQuery.each(vcht_data.contactFields,function(){var l=jQuery('<div class="form-group" data-id="'+this.id+'"></div>');var i="";var j="";if(this.icon!=""){if(this.iconPosition=="1"){i='<div class="input-group">';j='<span class="input-group-addon" id="basic-addon1"><span class="fa '+this.icon+'"></span></span></div>'}else{i='<div class="input-group"><span class="input-group-addon" id="basic-addon1"><span class="fa '+this.icon+'"></span></span>';j="</div>"}}l.append("<label>"+this.title+"</label>");if(this.type=="checkbox"){l.append('<input type="checkbox" data-toggle="switch" />')}else{if(this.type=="textarea"){l.append('<textarea class="form-control" >'+this.defaultValue+"</textarea>")}else{if(this.type=="dropdown"){var h=this.optionsValues.split(",");var f=jQuery('<select class="form-control"  ></select>');jQuery.each(h,function(){f.append('<option value="'+this+'">'+this+"</option>")});l.append(f)}else{if(this.type=="numberfield"){var e="";if(this.valueMax>0){e='max="'+this.valueMax+'"'}l.append(i+'<input type="number" class="form-control" min="'+this.valueMin+'" '+e+' value="'+this.defaultValue+'" />'+j)}else{var k="text";var g="";if(this.infoType=="email"){k="email";g='name="email"'}l.append(i+'<input type="'+k+'" '+g+' class="form-control" placeholder="'+this.placeholder+'"  value="'+this.defaultValue+'" />'+j)}}}}jQuery("#vcht_chatContactForm").append(l)});if(vcht_data.contactFields.length>0){jQuery("#vcht_chatContactForm").append('<a href="javascript:" class="btn btn-primary" onclick="vcht_sendContactForm();"><span class="fa fa-paper-plane"></span>'+vcht_data.texts["Send this message"]+"</a>")}jQuery("#vcht_chatContactForm").append('<div id="vcht_contactAnswer">'+vcht_data.texts["Thank you.[n]Your message has been sent.[n]We will contact you soon."]+"</div>")}c.append('<div id="vcht_chatLoginForm" class="vcht_scrollbar"></div>');if(vcht_data.loginFormIcon!=""){jQuery("#vcht_chatLoginForm").append('<div class="vcht_mainIcon"><span class="fa '+vcht_data.loginFormIcon+'"></span></div>')}jQuery.each(vcht_data.loginFields,function(){var l=jQuery('<div class="form-group" data-id="'+this.id+'" data-isrequired="'+this.isRequired+'" data-validation="'+this.validation+'"></div>');l.append("<label>"+this.title+"</label>");var i="";var j="";if(this.icon!=""){if(this.iconPosition=="1"){i='<div class="input-group">';j='<span class="input-group-addon" id="basic-addon1"><span class="fa '+this.icon+'"></span></span></div>'}else{i='<div class="input-group"><span class="input-group-addon" id="basic-addon1"><span class="fa '+this.icon+'"></span></span>';j="</div>"}}if(this.type=="checkbox"){l.append('<input type="checkbox" data-toggle="switch" />')}else{if(this.type=="textarea"){l.append('<textarea class="form-control" >'+this.defaultValue+"</textarea>")}else{if(this.type=="dropdown"){var h=this.optionsValues.split(",");var f=jQuery(i+'<select class="form-control"></select>'+j);jQuery.each(vcht_data.contactFields,function(){f.append('<option value="'+this+'">'+this+"</option>")});l.append(f)}else{if(this.type=="numberfield"){var e="";if(this.valueMax>0){e='max="'+this.valueMax+'"'}l.append(i+'<input type="number" class="form-control"  min="'+this.valueMin+'" '+e+' value="'+this.defaultValue+'" />'+j)}else{var k="text";var g="";if(this.infoType=="email"){k="email";g='name="email"'}l.append(i+'<input type="'+k+'" '+g+' class="form-control" placeholder="'+this.placeholder+'"  value="'+this.defaultValue+'" />'+j)}}}}jQuery("#vcht_chatLoginForm").append(l)});jQuery('.vcht_bootstrap [data-toggle="switch"]').vcht_BootstrapSwitch();jQuery("#vcht_chatLoginForm").append('<a href="javascript:" onclick="vcht_validLoginForm();" class="btn btn-primary"><span class="fa fa-check"></span>'+vcht_data.texts.Start+"</a>");var b=jQuery('<div id="vcht_chatCommPanel"></div>');b.append('<div id="vcht_history" class="vcht_scrollbar"></div>');b.append('<div id="vcht_writeMsgContainer"></div>');b.find("#vcht_writeMsgContainer").append('<div id="vcht_writeBtnsCt"></div>');b.find("#vcht_writeMsgContainer").append('<textarea id="vcht_chatPanelMsgArea" class="form-control"></textarea>');if(vcht_data.allowFilesFromCustomers==1){b.find("#vcht_writeBtnsCt").append('<a href="javascript:" id="vcht_btnUploadFiles" data-title="'+vcht_data.texts["Transfer some files"]+'" data-toggle="tooltip" onclick="vcht_openUploadPanel();" class="btn btn-default btn-circle"><span class="fa fa-paperclip"></span></a>')}b.find("#vcht_writeBtnsCt").append('<a href="javascript:" onclick="vcht_sendMessage();" data-title="'+vcht_data.texts["Send this message"]+'" data-toggle="tooltip" class="btn btn-primary btn-circle"><span class="fa fa-paper-plane"></span></a>');c.append(b);if(vcht_data.allowFilesFromCustomers=="1"){var d=jQuery('<div id="vcht_uploadFilesPanel"></div>');d.append('<div id="vcht_uploadFilesField" class="vcht_dropzone dropzone"></div>');d.append('<div id="vcht_uploadFilesBtnCt"><a href="javascript:" onclick="vcht_validFilesUpload();" class="btn btn-primary"><span class="fa fa-cloud-upload"></span>'+vcht_data.texts.Confirm+"</a></div>");c.append(d)}c.append('<div id="vcht_chatLoaderCt"><div id="vcht_chatLoader"><div class="vcht_spinner"><div class="vcht_double-bounce1"></div><div class="vcht_double-bounce2"></div></div></div></div>');jQuery("#vcht_chatPanel").addClass("vcht_minify");jQuery("#vcht_btnMinify span").removeClass("fa-window-minimize").addClass("fa-window-restore");jQuery("#vcht_chatPanel").css({bottom:0-(jQuery("#vcht_chatPanel").outerHeight()-jQuery("#vcht_chatHeader").outerHeight())});setTimeout(function(){jQuery("#vcht_chatPanel").css({opacity:1})},251);jQuery("#vcht_chatPanel .vcht_scrollbar").mCustomScrollbar();jQuery("#vcht_uploadFilesField").dropzone({url:vcht_data.ajaxurl,paramName:"file",maxFilesize:vcht_data.filesMaxSize,maxFiles:vcht_data.filesMaxSize,addRemoveLinks:true,dictRemoveFile:"",dictCancelUpload:"",acceptedFiles:vcht_data.allowedFiles,dictDefaultMessage:vcht_data.texts["Drop files to upload here"],dictFileTooBig:vcht_data.texts["The selected file exceeds the authorized size"],dictInvalidFileType:vcht_data.texts["The selected type of file is not allowed"],dictMaxFilesExceeded:vcht_data.texts["You can not upload any more files"],init:function(){vcht_uploadFilesDropzone=Dropzone.forElement("#vcht_uploadFilesField");this.on("thumbnail",function(f,g){var e=jQuery(f.previewElement);e.attr("data-file",f)});this.on("sending",function(e,g,f){f.append("action","client_uploadFile");f.append("receiverID",vcht_currentOperator.id);jQuery("#vcht_uploadFilesBtnCt >a.btn").fadeOut()}),this.on("complete",function(e,f){if(jQuery("#vcht_uploadFilesField").find(".dz-preview:not(.dz-complete)").length==0||dropzone.find(".dz-preview").length==0){jQuery("#vcht_uploadFilesBtnCt >a.btn").fadeIn()}});this.on("success",function(f,g){var e=jQuery(f.previewElement);e.attr("data-file",f.name)});this.on("removedfile",function(e,f){})}});jQuery("#vcht_chatPanelMsgArea").keypress(function(f){if(f.which==13){vcht_sendMessage();return false}});jQuery("#vcht_chatLoginForm").find("input,textarea").keypress(function(f){if(f.which==13){if(jQuery(this).closest(".form-group").index()<jQuery(this).closest(".form-group").parent().children.length-2){jQuery(this).closest(".form-group").next(".form-group").find("input,textarea").focus()}else{vcht_validLoginForm()}return false}});jQuery('#vcht_chatPanel [data-toggle="tooltip"]').v_tooltip()}function vcht_getLoginFieldByID(b){var a=false;jQuery.each(vcht_data.loginFields,function(){if(this.id==b){a=this}});return a}function vcht_getFieldByID(b){var a=false;jQuery.each(vcht_data.contactFields,function(){if(this.id==b){a=this}});if(!a){jQuery.each(vcht_data.loginFields,function(){if(this.id==b){a=this}})}return a}function vcht_checkFieldsError(b){var a=false;b.find('.form-group[data-isrequired="1"],.form-group[data-validation!=""]').each(function(){var d=vcht_getFieldByID(jQuery(this).attr("data-id"));if(d!=false){if(d.validation!=""&&d.type=="textfield"&&(jQuery(this).find("input").val()!=""||jQuery(this).attr('[data-isrequired="1"]'))){if(d.validation=="phone"&&(jQuery(this).find("input.form-control").val().length<5||/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i.test(jQuery(this).find("input.form-control").val())==false)){a=true;jQuery(this).addClass("has-error")}else{if(d.validation=="email"&&jQuery(this).find("input").val().length>0&&!vcht_checkEmail(jQuery(this).find("input.form-control").val())){a=true;jQuery(this).addClass("has-error")}else{if(d.validation=="fill"&&jQuery(this).find("input.form-control").val().trim().length<1){a=true;jQuery(this).addClass("has-error")}else{if(d.validation=="custom"){if(parseInt(d.valueMin)>0&&jQuery(this).find("input.form-control").val().length<parseInt(d.valueMin)){a=true;jQuery(this).addClass("has-error")}if(parseInt(d.valueMax)>0&&jQuery(this).find("input.form-control").val().length>parseInt(d.valueMax)){a=true;jQuery(this).addClass("has-error")}if(jQuery(this).attr("data-validcar")!=""){var d=jQuery(this);if(d.validationCaracts.indexOf(",")>-1){var c=d.validationCaracts.split(",");jQuery.each(c,function(){if(d.val().indexOf(this)==-1){a=true;jQuery(this).addClass("has-error")}})}else{if(d.val().indexOf(d.validationCaracts)==-1){a=true;jQuery(this).addClass("has-error")}}}}}}}}if(d.isRequired==1){if(jQuery(this).find('input[type="checkbox"]').length>0){if(!jQuery(this).find('input[type="checkbox"]').vcht_BootstrapSwitch("state")){a=true;jQuery(this).addClass("has-error")}}else{if(jQuery(this).find(".form-control").val().trim().length<1){a=true;jQuery(this).addClass("has-error")}}}}});return a}function vcht_sendContactForm(){var b=false;var a=new Array();jQuery("#vcht_chatContactForm .form-group").removeClass("has-error");b=vcht_checkFieldsError(jQuery("#vcht_chatContactForm"));jQuery("#vcht_chatContactForm .form-group").each(function(){var c=vcht_getFieldByID(jQuery(this).attr("data-id"));if(c.type=="checkbox"){a.push({id:c.id,value:jQuery(this).find('input[type="checkbox"]').vcht_BootstrapSwitch("state")})}else{a.push({id:c.id,value:jQuery(this).find(".form-control").val()})}});if(!b){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_sendContactForm",fields:a},success:function(c){}});jQuery("#vcht_chatContactForm .form-group").removeClass("has-error");jQuery("#vcht_chatContactForm .form-group").each(function(){var c=vcht_getFieldByID(jQuery(this).attr("data-id"));if(c.type=="checkbox"){jQuery(this).find('[type="checkbox"]').is(":checked")}else{jQuery(this).find(".form-control").val(c.defaultValue)}});jQuery("#vcht_chatContactForm .mCSB_container").children(":not(#vcht_contactAnswer):not(.vcht_mainIcon),a.btn").fadeOut();setTimeout(function(){jQuery("#vcht_chatContactForm").find("#vcht_contactAnswer").fadeIn()},250);setTimeout(function(){vcht_minify();setTimeout(function(){jQuery("#vcht_chatContactForm .mCSB_container").children(":not(#vcht_contactAnswer):not(.vcht_mainIcon),a.btn").fadeIn();jQuery("#vcht_chatContactForm").find("#vcht_contactAnswer").fadeOut()},250)},5000)}}function vcht_checkEmail(a){if(a.indexOf("@")!="-1"&&a.indexOf(".")!="-1"&&a!=""){return true}return false}function vcht_onChatOpen(){if(vcht_chatID==0&&!vcht_isLogged){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_checkOnlineOperator"},success:function(a){a=a.trim();jQuery("#vcht_chatLoaderCt").fadeOut();setTimeout(function(){vcht_onResize();jQuery("#vcht_history").mCustomScrollbar("scrollTo","bottom")},255);if(a=="1"){if(sessionStorage.getItem("vcht_fields")===null){if(vcht_data.enableLoginPanel==1){jQuery("#vcht_chatLoginForm").show()}else{jQuery("#vcht_chatLoginForm").hide();vcht_startChat()}}else{vcht_startChat()}jQuery("#vcht_chatContactForm").hide()}else{jQuery("#vcht_chatLoginForm").hide();jQuery("#vcht_chatContactForm").show();if(jQuery("#vcht_chatPanel").is(".vcht_minify")){setTimeout(function(){jQuery("#vcht_chatLoaderCt").fadeOut()},251)}else{jQuery("#vcht_chatLoaderCt").fadeOut()}}}})}}function vcht_startChat(a,b){vcht_isLogged=true;jQuery("#vcht_loader").fadeIn();jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_startChat",fields:a},success:function(c){if(sessionStorage.getItem("vcht_geoSend")===null||sessionStorage.vcht_geoSend!=="true"){vcht_geoSend()}c=JSON.parse(c);vcht_currentUser=c;vcht_currentUser.history=new Array();setTimeout(function(){jQuery("#vcht_chatContactForm").hide();jQuery("#vcht_chatLoginForm").hide();jQuery("#vcht_chatCommPanel").show();vcht_onResize();jQuery("#vcht_btnUploadFiles").attr("disabled","disabled");if(!b){vcht_writeStartMsg()}if(sessionStorage.getItem("vcht_isChatting")!==null&&sessionStorage.vcht_isChatting){vcht_getLastHistory()}},250)}})}function vcht_validLoginForm(){if(vcht_data.enableLoginPanel==1){var b=false;if(sessionStorage.getItem("vcht_fields")===null){var a=new Array();jQuery("#vcht_chatLoginForm .form-group").removeClass("has-error");b=vcht_checkFieldsError(jQuery("#vcht_chatLoginForm"));jQuery("#vcht_chatLoginForm .form-group").each(function(){var c=vcht_getFieldByID(jQuery(this).attr("data-id"));if(c.type=="checkbox"){a.push({id:c.id,value:jQuery(this).find('input[type="checkbox"]').vcht_BootstrapSwitch("state")})}else{a.push({id:c.id,value:jQuery(this).find(".form-control").val()})}})}else{a=JSON.parse(sessionStorage.vcht_fields)}if(!b){sessionStorage.vcht_fields=JSON.stringify(a);vcht_startChat(a)}}}function vcht_minify(){jQuery("#vcht_btnFullScreen span").removeClass("fa-window-restore").addClass("fa-window-maximize");if(!jQuery("#vcht_chatPanel").is(".vcht_minify")){vcht_stopShowElement();jQuery("#vcht_chatPanel").addClass("vcht_minify");var a=0;if(jQuery("#vcht_chatPanel").is(".vcht_fullscreen")){a=251}jQuery("#vcht_chatPanel").removeClass("vcht_fullscreen");jQuery("#vcht_btnMinify span").removeClass("fa-window-minimize").addClass("fa-window-restore");setTimeout(function(){jQuery("#vcht_chatPanel").css({bottom:0-(jQuery("#vcht_chatPanel").outerHeight()-jQuery("#vcht_chatHeader").outerHeight())})},a)}else{setTimeout(function(){jQuery("#vcht_btnMinify span").removeClass("fa-window-restore").addClass("fa-window-minimize")},251);vcht_expand()}setTimeout(vcht_onResize,251)}function vcht_expand(){jQuery("#vcht_chatPanel").removeClass("vcht_minify");jQuery("#vcht_chatPanel").removeClass("vcht_fullscreen");jQuery("#vcht_chatPanel").css({bottom:0});vcht_onChatOpen()}function vcht_fullscreen(){jQuery("#vcht_chatPanel").removeClass("vcht_minify");jQuery("#vcht_btnMinify span").removeClass("fa-window-restore").addClass("fa-window-minimize");if(!jQuery("#vcht_chatPanel").is(".vcht_fullscreen")){jQuery("#vcht_chatPanel").addClass("vcht_fullscreen");jQuery("#vcht_btnFullScreen span").removeClass("fa-window-maximize").addClass("fa-window-restore")}else{jQuery("#vcht_chatPanel").removeClass("vcht_fullscreen");jQuery("#vcht_btnFullScreen span").removeClass("fa-window-restore").addClass("fa-window-maximize")}jQuery("#vcht_chatPanel").css({bottom:0});vcht_onChatOpen();setTimeout(vcht_onResize,251)}function vcht_closeChat(d){var c=0;if(!jQuery("#vcht_chatPanel").is(".vcht_minify")){vcht_minify();c=251}vcht_stopShowElement();setTimeout(function(){jQuery("#vcht_history .vcht_message:not(.vcht_startMsg)").remove()},c);if(!d){jQuery("#vcht_chatPanel").addClass("vcht_hiddenPanel");setTimeout(function(){jQuery("#vcht_chatPanel").css({bottom:0-(jQuery("#vcht_chatPanel").height()+18)})},c)}if(vcht_data.enableLoginPanel==1){jQuery("#vcht_chatLoginForm").show();jQuery("#vcht_chatCommPanel").hide()}jQuery("#vcht_history .mCSB_container").html("");sessionStorage.vcht_isChatting=false;var a=0;if(d){a=1}var b=0;if(vcht_currentOperator){b=vcht_currentOperator.id}jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_closeChat",keepOnline:a,receiverID:b}})}function vcht_writeStartMsg(){if(jQuery("#vcht_history .vcht_mssage").length==0){$item=jQuery('<div class="vcht_message vcht_operatorMsg vcht_startMsg"></div>');$item.append('<img class="vcht_avatar" src="'+vcht_data.defaultImgAvatar+'" />');var a=new Date();var b=jQuery('<div class="vcht_bubbleContainer"></div>');b.append('<div class="vcht_infos">'+vcht_addZero(a.getHours())+":"+vcht_addZero(a.getMinutes())+" :</div>");b.append('<div class="vcht_bubble">'+vcht_data.texts["Hello! How can we help you ?"]+"</div>");$item.append(b);jQuery("#vcht_history .mCSB_container").append($item);$item.stop().slideDown();setTimeout(function(){jQuery("#vcht_history").mCustomScrollbar("scrollTo","bottom")},400)}}function vcht_addZero(a){if(a<10){a="0"+a}return a}function vcht_sendMessage(){var d=-1;if(vcht_currentOperator!=false){d=vcht_currentOperator.id}vcht_stopShowElement();jQuery("#vcht_chatPanelMsgArea").removeClass("vcht_error");var b=jQuery("#vcht_chatPanelMsgArea").val();if(b.length>0||vcht_currentFiles.length>0){jQuery("#vcht_chatPanelMsgArea").val("");jQuery("#vcht_chatPanelMsgArea").select();var c={id:0,content:b,receiverID:d,senderID:vcht_currentUser.id,files:vcht_currentFiles,page:document.location.href,domElement:""};var a=vcht_writeMsg(c);jQuery("#vcht_chatPanelFilesBtn").removeClass("vcht_active");jQuery("#vcht_chatPanelShowElementBtn").removeClass("vcht_active");if(vcht_data.allowFilesFromCustomers==1){vcht_uploadFilesDropzone.removeAllFiles()}jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_sendMessage",receiverID:d,senderID:vcht_currentUser.id,content:b,files:JSON.stringify(vcht_currentFiles),page:document.location.href},success:function(e){e=parseInt(e.trim());a.attr("data-id",e)}});vcht_currentFiles=new Array();jQuery("#vcht_btnUploadFiles").removeClass("vcht_active");if(!vcht_checkMsgTimer){}}else{jQuery("#vcht_chatPanelMsgArea").addClass("vcht_error")}}function vcht_checkNewMessages(){if(sessionStorage.getItem("vcht_isChatting")!==null&&sessionStorage.getItem("vcht_isChatting")=="true"){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_getNewMessages",page:document.location.href},success:function(a){if(sessionStorage.vcht_isChatting){a=a.trim();a=jQuery.parseJSON(a);jQuery.each(a,function(b){this.files=jQuery.parseJSON(this.files);vcht_addToHistory(this);if(b==a.length-1){var c=this;if(c.domElement!=""){if(vcht_shownElement!=c.domElement&&c.senderID!=vcht_currentUser.id){vcht_shownElement=c.domElement;vcht_showUrl(c.page)}}}})}}})}}function vcht_writeMsg(h,a){var b=false;var f=vcht_currentUser;var e="";if(h.senderID!=f.id){f=vcht_currentOperator;e="vcht_operatorMsg"}else{f.avatarImg=vcht_data.customerImgAvatar}if(jQuery('#vcht_history .vcht_message[data-id="'+h.id+'"]').length==0||h.id==0){if(h.type=="close"&&h.senderID!=vcht_currentUser.id){h.content=vcht_data.texts["[username] stopped the chat"];h.content=h.content.replace("[username]",f.username);if(!a){setTimeout(function(){if(jQuery("#vcht_chatPanel").is(".vcht_minify")){vcht_minify()}vcht_closeChat(true)},3000)}}if(h.type=="transfer"){h.content=vcht_data.texts["[username1] tranfers the chat to [username2]"];h.content=h.content.replace("[username1]",f.username);h.content=h.content.replace("[username2]",h.transferUsername);vcht_currentOperator.username=h.transferUsername;vcht_currentOperator.id=h.transferID;vcht_getOperatorInfos(h.senderID)}b=jQuery('<div class="vcht_message  '+e+'" data-id="'+h.id+'"></div>');b.append('<img class="vcht_avatar" src="'+f.avatarImg+'" />');var d=new Date();var g=jQuery('<div class="vcht_bubbleContainer"></div>');g.append('<div class="vcht_infos">'+vcht_addZero(d.getHours())+":"+vcht_addZero(d.getMinutes())+", "+f.username+" :</div>");g.append('<div class="vcht_bubble">'+h.content+"</div>");if(h.files&&h.files.length>0){var c=jQuery('<div class="vcht_messageFiles"></div>');jQuery.each(h.files,function(){var i="fa-file-text-o";var j=this.substr(this.lastIndexOf(".")+1).toLowerCase();if(j=="jpg"||j=="png"||j=="gif"||j=="tif"||j=="svg"||j=="bmp"||j=="jpeg"){i="fa-file-image-o"}else{if(j=="doc"||j=="docx"){i="fa-file-word-o"}else{if(j=="zip"||j=="rar"||j=="7z"||j=="gzip"){i="fa-file-archive-o"}else{if(j=="pdf"){i="fa-file-pdf-o"}else{if(j=="mp4"||j=="3gp"||j=="avi"||j=="mpeg"||j=="mov"||j=="webm"){i="fa-file-video-o"}else{if(j=="ppt"){i="fa-file-powerpoint-o"}}}}}}c.append('<div class="vcht_messageFile"><span class="fa '+i+'"></span>'+this+"</div>")});g.find(".vcht_bubble").append(c)}if(h.domElement!=""){g.find(".vcht_bubble").append('<a href="javascript:" onclick="vcht_clickShownElement(this);" class="vcht_elementShown" data-domelement="'+h.domElement+'" data-page="'+h.page+'"><span class="fa fa-eye"></span>'+vcht_data.texts["Shows an element of the website"]+"</a>")}if(g.find(".vcht_bubble").text().length>0){b.append(g);jQuery("#vcht_history .mCSB_container").append(b);b.stop().slideDown();setTimeout(function(){jQuery("#vcht_history").mCustomScrollbar("scrollTo","bottom")},400)}}return b}function vcht_getUserByID(a){var b=false;jQuery.each(vcht_allUsers,function(){if(this.id==a){b=this}});return b}function vcht_addToHistory(d,c,a){var b=vcht_currentOperator;vcht_currentUser.history.push(d);if(d.senderID==vcht_currentUser.id){b=vcht_currentUser;if(c){vcht_writeMsg(d,a)}}else{if(!vcht_currentOperator){sessionStorage.vcht_isChatting=true;vcht_currentOperator={id:0,history:new Array()};vcht_currentOperator.history.push(d);vcht_getOperatorInfos(d.senderID)}else{if(vcht_currentOperator.id==0){vcht_currentOperator.history.push(d)}else{jQuery("#vcht_btnUploadFiles").removeAttr("disabled");vcht_writeMsg(d,a)}}}}function vcht_getOperatorInfos(a){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_getOperatorInfos",operatorID:a},success:function(b){b=JSON.parse(b);vcht_currentOperator.id=b.id;vcht_currentOperator.username=b.username;vcht_currentOperator.avatarImg=b.avatar;vcht_currentOperator.id=b.id;jQuery("#vcht_btnUploadFiles").removeAttr("disabled");jQuery.each(vcht_currentOperator.history,function(){vcht_writeMsg(this,true)})}})}function vcht_clickShownElement(a){var c=jQuery(a).attr("data-domelement");var b=jQuery(a).attr("data-page");vcht_shownElement=c;vcht_showUrl(b)}function vcht_showUrl(a){var b=document.location.href;if(a==""){a=b}if(b.substr(b.length-1,1)=="/"){b=b.substr(0,b.length-1)}if(a.substr(a.length-1,1)=="/"){a=a.substr(0,a.length-1)}if(a.indexOf("http://")==0&&b.indexOf("https://")==0){a="https://"+a.substr(7,a.length)}else{if(a.indexOf("https://")==0&&b.indexOf("https://")==0){a="http://"+a.substr(8,a.length)}}if(a==b){if(vcht_shownElement!=""){vcht_showElement(vcht_shownElement,false)}}else{sessionStorage.vcht_shownElement=vcht_shownElement;document.location.href=a}}function vcht_openUploadPanel(){if(!jQuery("#vcht_btnUploadFiles").is("[disabled]")){jQuery("#vcht_chatCommPanel").fadeOut();setTimeout(function(){jQuery("#vcht_uploadFilesPanel").fadeIn();vcht_onResize()},251)}}function vcht_validFilesUpload(){vcht_currentFiles=new Array();jQuery("#vcht_uploadFilesField .dz-preview.dz-success").each(function(){var a=jQuery(this).attr("data-file");a=a.replace(/ /g,"_");vcht_currentFiles.push(a)});jQuery("#vcht_uploadFilesPanel").fadeOut();if(vcht_currentFiles.length>0){jQuery("#vcht_btnUploadFiles").addClass("vcht_active")}else{jQuery("#vcht_btnUploadFiles").removeClass("vcht_active")}setTimeout(function(){jQuery("#vcht_chatCommPanel").fadeIn();vcht_onResize()},251)}function vcht_getLastHistory(){jQuery.ajax({url:vcht_data.ajaxurl,type:"post",data:{action:"client_getLastHistory"},success:function(a){a=a.trim();a=jQuery.parseJSON(a);if(vcht_currentUser.history==null){vcht_currentUser.history=new Array()}jQuery.each(a,function(){this.files=jQuery.parseJSON(this.files);vcht_addToHistory(this,true,true)});if(!vcht_checkMsgTimer){}}})}function vcht_initBounce(){if(vcht_data.bounceFx=="1"){if(vcht_timerBounce){clearInterval(vcht_timerBounce)}vcht_timerBounce=setInterval(function(){if(jQuery("#vcht_chatPanel").is(".vcht_minify")&&!jQuery("#vcht_chatPanel").is(".vcht_hiddenPanel")){jQuery("#vcht_chatPanel").css({bottom:0-((jQuery("#vcht_chatPanel").outerHeight()-jQuery("#vcht_chatHeader").outerHeight())+28)});setTimeout(function(){if(jQuery("#vcht_chatPanel").is(".vcht_minify")){jQuery("#vcht_chatPanel").css({bottom:0-(jQuery("#vcht_chatPanel").outerHeight()-jQuery("#vcht_chatHeader").outerHeight())})}},800)}},4000)}};